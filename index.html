<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø²Ù…Ø§Ù†: ØªØ¬Ø±Ø¨Ø© ØºØ§Ù…Ø±Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Desert Sands & Papyrus with cinematic accents -->
    <!-- Application Structure Plan: Full-screen cinematic narrative. Each scene is a distinct visual and auditory experience. Dynamic background images, animated emojis, and orchestrated ambient soundscapes using Tone.js. Navigation via next/prev buttons. AI interaction for "Inspirational Question," "Imagine Your First Day," and "Personalized Welcome Message." Global audio controls. The design emphasizes immersive storytelling over traditional web layout. -->
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #FDF8F0;
            color: #4E4234;
            overflow: hidden; /* Hide scrollbars for full-screen effect */
        }
        .bg-primary { background-color: #FDF8F0; }
        .bg-secondary { background-color: #F5EFE1; }
        .text-primary { color: #4E4234; }
        .text-accent { color: #8D6B4C; }
        .bg-accent { background-color: #D4A056; }
        .bg-accent-hover:hover { background-color: #C08C3B; }
        .shadow-custom { 
            box-shadow: 0 10px 30px -5px rgba(141, 107, 76, 0.15), 0 6px 12px -6px rgba(141, 107, 76, 0.1); 
        }
        .text-shadow-light {
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #D4A056;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Full-screen scene container */
        .scene-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 1.5s ease-in-out; /* Smooth transition for background image */
            position: relative;
            overflow: hidden; 
        }
        /* No more ::before for gradients, background-image will be set directly */

        /* Animations for visual dazzle */
        @keyframes fadeInText {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeInText {
            animation: fadeInText 1s ease-out forwards;
        }

        @keyframes pulseIcon {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .animate-pulseIcon {
            animation: pulseIcon 1.5s ease-in-out infinite; /* Continuous pulse */
        }
    </style>
</head>
<body class="bg-primary">
    <nav class="absolute top-0 left-0 right-0 z-50 bg-primary/80 backdrop-blur-md shadow-sm hidden md:block">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-accent text-shadow-light">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø²Ù…Ø§Ù†</span>
                </div>
                <div>
                    <div class="ml-10 flex items-baseline space-x-4 space-x-reverse">
                        <a href="#story-container" class="text-primary hover:text-accent px-3 py-2 rounded-md text-sm font-medium">Ø§Ù„Ù‚ØµØ©</a>
                        <a href="#call-to-action" class="text-primary hover:text-accent px-3 py-2 rounded-md text-sm font-medium">Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <section id="story-container" class="scene-container">
            <div class="relative z-10 max-w-4xl w-full bg-secondary/90 p-8 rounded-xl shadow-custom text-center animate-fadeInText">
                <h1 id="story-title" class="text-4xl md:text-5xl font-bold text-accent leading-tight mb-6 text-shadow-light"></h1>
                <p id="story-text" class="mt-6 text-lg md:text-xl text-primary leading-relaxed"></p>
                <div class="mt-6 text-5xl">
                    <span id="story-icon"></span>
                </div>

                <div id="ai-response-area" class="mt-6 p-4 bg-primary rounded-lg shadow-inner text-primary hidden animate-fadeIn">
                    <div class="loading-spinner hidden"></div>
                    <p id="ai-response-text" class="leading-relaxed"></p>
                </div>
                
                <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="prev-scene-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105 opacity-50 cursor-not-allowed">
                        Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                    <button id="next-scene-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                        Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ
                    </button>
                </div>
                <div class="mt-4 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <span class="text-primary"><span id="current-scene-indicator">1</span> / <span id="total-scenes-indicator"></span></span>
                    <button id="read-text-btn" class="bg-accent text-white font-bold py-2 px-6 rounded-full text-sm bg-accent-hover transition-all duration-300">
                        Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ ğŸ”Š
                    </button>
                </div>
                <div class="mt-6">
                    <button id="inspire-me-btn" class="bg-accent text-white font-bold py-2 px-6 rounded-full text-sm bg-accent-hover transition-all duration-300">
                        Ø§ÙƒØªØ´Ù Ù„Ù…Ø­Ø© Ù…Ù† Ø§Ù„Ù…Ø§Ø¶ÙŠ âœ¨
                    </button>
                    <button id="imagine-first-day-btn" class="bg-accent text-white font-bold py-2 px-6 rounded-full text-sm bg-accent-hover transition-all duration-300 ml-4">
                        ØªØ®ÙŠÙ„ ÙŠÙˆÙ…Ùƒ Ø§Ù„Ø£ÙˆÙ„ ÙƒØ·Ø§Ù„Ø¨ âœ¨
                    </button>
                </div>
            </div>
        </section>

        <section id="call-to-action" class="min-h-screen flex items-center justify-center py-20 bg-secondary text-center">
            <div class="max-w-3xl mx-auto px-4">
                <h2 class="text-3xl font-bold text-accent mb-6 text-shadow-light">Ù‚ØµØªÙƒÙ… ØªØ¨Ø¯Ø£ Ù‡Ù†Ø§!</h2>
                <p class="text-lg text-primary mb-8">ÙÙŠ Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©ØŒ Ø£Ù†Øª Ù„Ø§ ØªØ¯Ø±Ø³Ù ÙÙ‚Ø·ØŒ Ø¨Ù„ ØªÙØµØ¨Ø­Ù Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ù‚ØµØ©Ù ØªØ§Ø±ÙŠØ®ÙŠØ©Ù Ø¹Ø±ÙŠÙ‚Ø©Ù ØªØ±Ø­Ø¨Ù Ø¨ÙƒÙ ÙˆØªÙØ­ØªØ¶Ù†ÙƒÙ. Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ Ù„ÙØªØ¨Ø¯Ø£Ù ÙØµÙ„ÙƒÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ù!</p>
                
                <div class="mt-10 p-6 bg-primary rounded-xl shadow-custom">
                    <h3 class="text-xl font-bold text-accent mb-4">Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø´Ø®ØµÙŠØ© Ù…Ù† Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ© âœ¨</h3>
                    <div class="flex flex-col sm:flex-row gap-4 mb-4">
                        <input type="text" id="student-name-input" class="flex-grow p-3 text-primary bg-secondary rounded-lg border-2 border-accent/30 focus:outline-none focus:border-accent shadow-inner" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                        <input type="text" id="student-country-input" class="flex-grow p-3 text-primary bg-secondary rounded-lg border-2 border-accent/30 focus:outline-none focus:border-accent shadow-inner" placeholder="Ø¨Ù„Ø¯Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>
                    <button id="get-personalized-welcome-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                        Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„ØªÙƒ!
                    </button>
                    <div id="personalized-welcome-output" class="mt-6 p-4 bg-secondary rounded-lg shadow-inner text-primary hidden animate-fadeIn">
                        <div class="loading-spinner hidden"></div>
                        <p></p>
                    </div>
                </div>

                <a href="#" class="mt-8 inline-block bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                    Ø§ÙƒØªØ´Ù Ø¬Ø§Ù…Ø¹Ø© Ù‚Ù†Ø§Ø© Ø§Ù„Ø³ÙˆÙŠØ³
                </a>
            </div>
        </section>
    </main>

    <footer class="bg-primary">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-primary">
            <p>&copy; 2025 Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø²Ù…Ø§Ù†. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
        </div>
    </footer>

    <div class="fixed bottom-4 left-4 bg-secondary p-3 rounded-full shadow-lg flex items-center space-x-2 z-50">
        <button id="toggle-music" class="text-accent text-xl focus:outline-none">
            ğŸ¶
        </button>
        <button id="toggle-ambient-sound" class="text-accent text-xl focus:outline-none">
            ğŸƒ
        </button>
    </div>

    <script>
        const storyScenes = [
            {
                title: "Ù…ÙÙ†Ù’ Ø±ÙØ­ÙÙ…Ù Ø§Ù„ØªØ§Ø±ÙŠØ®Ù ÙˆÙÙ„ÙØ¯ÙØªÙ’ Ù‡ÙÙˆÙŠÙÙ‘ØªÙÙŠ!",
                text: "Ø£Ù†Ø§ Ø§Ù„ØªÙŠ ÙˆÙÙ„ÙØ¯Ù’ØªÙ Ù‡Ù†Ø§Ø› Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø±Ø¶Ù. ÙˆÙ„ÙÙŠÙ Ø¹Ø¯ÙŠØ¯ÙŒ Ù…Ù† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡Ù.",
                icon: "â³",
                imageUrl: "https://placehold.co/1920x1080/6F5C4B/FFFFFF?text=Ancient+History",
                ambientSound: 'desert_wind'
            },
            {
                title: "ÙˆØ§Ø­Ø©ÙŒ Ù…Ù† Ø±Ù…Ø§Ù„Ù ÙˆÙ…Ø§Ø¡Ù",
                text: "ÙÙŠ ØºØ§Ø¨Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ ÙˆÙÙŠ Ù„Ø­Ø¸Ø©Ù Ù…Ø§ØŒ ØªÙ„Ø§Ù‚Øª Ù…ÙŠØ§Ù‡ Ø§Ù„Ù†ÙŠÙ„ Ù…Ø¹ Ø¨Ø­ÙŠØ±Ø©Ù Ù…ÙØ±ÙÙ‘Ø©. ÙØªØ´Ø¨Ø¹Øª Ø±ÙÙ…Ø§Ù„ÙÙŠÙ Ø§Ù„ØµÙØ±Ø§Ø¡ Ù…ÙØ§ÙØ¡Ù‹ Ù…Ø§Ù„Ø­Ù‹Ø§ Ø¹Ø°Ø¨Ù‹Ø§! Ø«Ù… ÙØ§Ø¶ÙØªÙ’ ØªÙØ±Ù’Ø¨ÙØªÙÙŠ Ù…ÙÙ†Ù Ø§Ù„Ø«ÙÙ…ÙØ±Ø§ØªÙ Ø£ÙØ´Ù’Ø¬ÙØ§Ø±Ù‹Ø§ØŒ ÙˆØ§Ø³ØªØ­Ø§Ù„Øª Ø§Ù„Ø£Ø±Ø¶ÙØ› Ø¨Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø£Ø´Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø«Ù…Ø±Ø§ØªØŒ Ù…Ø¹ Ù…Ø§ Ø¹Ø¯Ø§Ù‡Ø§ Ù…Ù† Ø´Ø¬Ø±Ù ÙƒØ«ÙŠÙÙØŒ Ø¥Ù„Ù‰ Ù…Ø§ ÙŠØ´Ø¨Ù‡ Ø§Ù„ÙˆØ§Ø­Ø©! ÙƒØ§Ù† Ù…ÙˆÙ‚Ø¹Ù Ù‚Ø¯Ù…ÙŠÙÙ‘ Ù…ÙØ°Ù‡Ù„Ù‹Ø§! ÙƒÙÙ†ØªÙ ÙÙŠ Ø§Ù„Ù…Ù„ØªÙ‚Ù‰ ØªÙ…Ø§Ù…Ù‹Ø§ØŒ Ø¨ÙŠÙ† Ø£Ø±Ø¶ Ø§Ù„Ø´Ø§Ù… ÙˆØ£Ø±Ø¶ Ù…ØµØ±! Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ù…Ù† Ø³ÙŠÙ†Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø±ÙƒØ©!",
                icon: "ğŸŒŠğŸŒ³",
                imageUrl: "https://placehold.co/1920x1080/4CAF50/FFFFFF?text=Desert+Oasis",
                ambientSound: 'oasis_life'
            },
            {
                title: "Ø¨ÙˆØ§Ø¨Ø©Ù Ø§Ù„Ø­Ø¶Ø§Ø±Ø§ØªÙ ÙˆÙ…Ù„ØªÙ‚Ù‰ Ø§Ù„ØªØ¬Ø§Ø±Ø©Ù",
                text: "ÙƒÙÙ†ØªÙ ÙƒØ§Ù„Ø¨ÙˆØ§Ø¨Ø©Ù Ø§Ù„ØªÙŠ ÙŠÙÙ…ÙØ±ÙÙ‘ Ù…Ù†Ù‡Ø§ Ù‚Ø§ØµØ¯Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ù„Ø§Ø¯ØŒ Ø£Ùˆ ØªÙ„Ùƒ! ÙˆÙƒØ°Ù„ÙƒØ› Ù„Ùˆ Ù†ÙØ¸ÙØ±Ù’ØªÙ Ù‡Ù†Ø§ÙƒØŒ ÙˆØ£Ù…Ø¹Ù†ØªÙ Ø§Ù„Ù†ÙØ¸ÙØ±Ù’Ø› Ù„ÙÙˆÙØ¬ÙØ¯Ù’ØªÙÙ†ÙÙŠ ÙÙŠ Ù…ÙÙ†Ù’ØªÙØµÙÙÙ Ø·ÙØ±ÙŠÙ‚Ù ØªØ¬Ø§Ø±Ø©ÙØ› Ù…Ø§ Ø¨ÙŠÙ† Ø¨ÙØ­Ù’Ø±ÙÙŠÙ†ÙØ› Ø¨Ù„ÙÙˆÙ†ÙÙŠÙ†ÙØŒ Ø£Ø­Ù…Ø±Ù ÙˆØ£Ø¨ÙŠØ¶Ù! ÙƒØ§Ù† Ù…ÙˆÙ‚ÙØ¹ÙÙŠ Ù…Ø«Ø§Ù„ÙŠÙ‹Ø§! ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹Ø› ÙƒØ§Ù† Ø¹Ø¨Ù‚Ø±ÙŠÙ‹Ø§! Ø£Ù†Ø§ ØµØ­Ø±Ø§Ø¡Ù Ù…Ù† Ø¬Ù‡Ø§ØªÙŠ Ø§Ù„Ø£Ø±Ø¨Ø¹! ÙˆÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ ØªÙ…Ø§Ù…Ù‹Ø§ØŒ Ø£Ù†Ø§ ÙˆØ§Ø­Ø©Ù Ù„Ù„Ø±Ø§Ø­Ø©! ÙƒÙ… Ø§Ø³ØªÙ‚Ù’Ø¨ÙÙ„Ù’ØªÙ Ù…ÙØ§Ø±Ù‹Ù‘Ø§ Ù…Ù† Ù‡Ù†Ø§! Ù…ÙØªÙÙ‘Ø¬ÙØ±Ù‹Ø§ ÙƒØ§Ù†Ø› Ø£Ùˆ Ø¹Ø§Ø¨Ø±Ù Ø³Ø¨ÙŠÙ„ÙØŸ ÙƒÙ… Ù…Ù† Ù…Ù„ÙˆÙƒ Ø§Ù„Ø£Ø±Ø¶Ù Ù…Ø±ÙÙ‘ÙˆØ§ Ù…Ù† Ù‡Ù†Ø§Ø› ØºØ§Ø²ÙŠÙ†ÙØŒ Ø£Ùˆ ÙØ§ØªØ­ÙŠÙ†ÙØŸ ÙƒÙ… Ù…Ù† Ø§Ù„ØµØ§Ù„Ø­ÙŠÙ†Ù! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù…Ù†Ø° Ø£ØµØ¨Ø­ Ø§Ù„ØªØ§Ø±ÙŠØ® ØµÙØ¨Ø­Ù‹Ø§. ÙˆÙ‡ÙÙˆÙŠÙÙ‘ØªÙÙŠ Ù‡ÙŠ Ø§Ù„Ø£Ø±Ø¶Ù. Ø£Ù†Ø§ ÙˆØ§Ø­Ø©! ÙˆÙ„ÙÙŠÙ Ø¹Ø¯ÙŠØ¯ÙŒ Ù…Ù† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡Ù.",
                icon: "ğŸ—ºï¸ğŸ•Œ",
                imageUrl: "https://placehold.co/1920x1080/D4A056/FFFFFF?text=Trade+Route+Gateway",
                ambientSound: 'trade_hub'
            },
            {
                title: "ØªØºÙŠØ±Ø§ØªÙ Ø§Ù„Ø¹ØµØ±Ù ÙˆÙ‚Ù†Ø§Ø©Ù Ø§Ù„Ø³ÙˆÙŠØ³Ù",
                text: "ÙÙŠ Ø¹ØµØ±ÙƒÙ… Ù‡Ø°Ø§! Ø¯Ø¹Ø§Ù†ÙŠ Ù…ÙÙ„ÙÙƒÙ‹Ø§ Ù…Ù† Ù…Ù„ÙˆÙƒÙ Ù…ØµØ± Ø¨Ø§Ø³Ù…Ù‡. ÙˆÙØ§Ø­ÙØªÙÙ‡ÙØ› ÙŠÙ‚ØµØ¯! ÙˆÙ…Ù†Ø° Ø£Ù† Ø¯Ø¹Ø§Ù†ÙŠ Ø¨Ø§Ø³Ù…Ù‡Ø› Ø£ØµØ¨ÙØ­ØªÙ ÙˆØ§Ø­Ø©Ù ÙƒÙÙ„ÙÙ‘ Ù…ÙÙ†Ù’ Ù…ÙÙ„ÙÙƒÙ Ø¨ÙØ¹Ù’Ø¯ÙÙ‡Ù. Ø¥Ù„Ø§ Ø£Ù†Ù‡ Ù‚Ø¯ Ø·ÙØ±ÙØ£ÙÙ†ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„ØªØºÙŠØ±! Ø¥Ø° Ø­Ø¬Ø²Øª Ù‚Ù†Ø§Ø©ÙØ› Ø´ÙÙ‚ÙÙ‘ØªÙ’ Ù…Ø§ Ø¨ÙŠÙ† Ø¨ÙØ­Ù’Ø±ÙÙŠÙ†ÙØŒ Ø¥Ù„Ù‰ Ø¥Ø®ØªÙ„Ø§ÙÙ ÙÙŠ Ø·Ø¨ÙŠØ¹ØªÙÙŠÙ. Ù„Ù… Ø£Ø¹ÙØ¯ Ø£Ø±Ù‰ Ø³ÙŠÙ†Ø§Ø¡ Ø§Ù„Ø­Ø¨ÙŠØ¨Ø© ÙƒÙ…Ø§ Ø§Ø¹ØªØ¯Ù’Øª Ø£Ù† Ø£Ø±Ø§Ù‡Ø§ Ø³Ø§Ø¨Ù‚Ù‹Ø§! Ø­ØªÙ‰ Ù‚ÙˆØ§ÙÙ„ Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª ÙƒØ«ÙŠØ±Ù‹Ø§ Ù…Ø§ ØªØ³ØªØ±ÙŠØ­Ù ØªØ­ØªÙ Ø£Ø´Ø¬Ø§Ø±ÙŠØ› Ø§Ø³ØªØ¨Ø¯Ù„ØªÙ’ Ø³ÙÙŠÙ†Ø© Ø§Ù„ØµØ­Ø±Ø§Ø¡ Ø¨Ø³ÙÙŠÙ†Ø©Ù Ø£Ø®Ø±Ù‰ ØªØ­Ù…Ù„Ù Ø¨Ø¶Ø§Ø¦Ø¹ÙÙ‡Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¡! Ù„ÙƒÙ†ÙŠ ÙƒÙ†Øª Ù‚Ø¯ Ø¨Ø¯Ø£Øª Ø£Ø³ØªØ­ÙŠÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¥Ù„Ù‰ Ù…Ø¯ÙŠÙ†Ø©ÙØŒ ÙˆÙ‚Ø¯ Ø§Ø³ØªÙ‚Ø± Ø§Ù„Ù…ÙÙ‚Ø§Ù… Ø¨Ø¨Ø¹Ø¶ Ù…Ù† Ø§Ù„Ø£ØºØ±Ø§Ø¨ØŒ Ø¨ÙŠØ¶Ù Ø§Ù„ÙˆØ¬ÙˆÙ‡ Ø´Ù‚Ø±Ù‹Ø§ØŒ ÙÙŠ Ø±Ø­Ø§Ø¨ÙŠ. ÙŠØ¯ÙŠØ±ÙˆÙ† Ø´Ø¦ÙˆÙ† Ø§Ù„Ù‚Ù†Ø§Ø©Ù Ø§Ù„ØªÙŠ Ø´ÙÙ‚ÙÙ‘Øª Ø¹Ù„Ù‰ ÙˆØ¬Ù‡ÙŠ! ÙˆØ§Ù†Ø¶Ù… Ø¨Ø¹Ø¶ Ø£Ù‡Ù„ Ù…ØµØ± Ù…Ù† Ø§Ù„Ø²ÙØ±ÙÙ‘Ø§Ø¹Ù ÙŠÙÙ„Ø­ÙˆÙ† ØªÙØ±Ø¨ÙØªÙŠØ› ÙˆÙ„Ù„Ø¹Ø¬Ø¨ÙØŒ Ø£Ù†ØªØ¬Øª Ø£Ø±Ø¶ÙŠ Ø£Ø´Ù‡Ù‰ Ø§Ù„ÙØ§ÙƒÙ‡Ø© ÙˆØ£Ø®Ø±Ø¬Øª Ø¨Ø­ÙŠØ±Ø§ØªÙŠ Ø£Ø´Ù‡Ø± Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ!",
                icon: "ğŸš¢ğŸ™ï¸",
                imageUrl: "https://placehold.co/1920x1080/87CEEB/FFFFFF?text=Suez+Canal+Modernization",
                ambientSound: 'urban_transformation'
            },
            {
                title: "Ø§Ù„ØªØ±Ø­ÙŠØ¨Ù ÙˆØ§Ù„ØµÙ…ÙˆØ¯Ù: Ù‡ÙÙˆÙŠÙÙ‘ØªÙÙŠ",
                text: "ÙƒÙ… Ø£Ø­Ø¨ÙÙ‘ Ù‡ÙÙˆÙŠÙÙ‘ØªÙÙŠ! Ø£Ù†Ø§ Ø¯ÙˆÙ…Ù‹Ø§ Ù…ÙØ±ÙØ­ÙØ¨Ù‡. Ø£Ø­Ø¨ Ø§Ù„Ø§Ø¨ØªØ³Ø§Ù…. Ø­ØªÙ‰ Ø¥Ù† Ø´Ø¹Ø§Ø±ÙŠ Ø§Ù„Ø°ÙŠ Ø§Ø³ØªÙ‚Ø¨Ù„ Ø¨Ù‡ Ø§Ù„Ø²ÙˆØ§Ø± ÙŠØ¨Ø¯Ø£ Ø¨Ù‡. Ø§Ø¨ØªØ³Ù….. Ø£Ù†Øª ÙÙŠ Ø­Ø¶Ø±ØªÙŠ! Ø«Ù… Ø¹Ø§Ù†ÙŠØªÙ ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø±ÙˆØ¨Ø› Ù„ÙƒÙ†ÙŠ ØµÙ…Ø¯Øª! Ø¨Ù„ Ø£Ù†ÙŠ Ø£Ø°ÙƒØ± Ù„Ø­Ø¸Ø© Ø¹Ø¨ÙˆØ±Ù ÙƒØªØ§Ø¦Ø¨ Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†ØŒ ØªØ³ØªØ±Ø¯ Ù„Ø¹ÙŠÙ†ÙŠØŒ Ø³ÙŠÙ†Ø§Ø¡ Ø§Ù„Ø­Ø¨ÙŠØ¨Ø©! Ù„Ø­Ø¸Ø© Ø¯Ø­Ø±Ù†Ø§ Ø§Ù„Ù…Ø¹ØªØ¯ÙŠ Ø§Ù„ØºØ§Ø²ÙŠ.",
                icon: "ğŸ˜ŠğŸ›¡ï¸",
                imageUrl: "https://placehold.co/1920x1080/FFC0CB/FFFFFF?text=Resilience+Welcome",
                ambientSound: 'resilience_spirit'
            },
            {
                title: "Ø¬Ø§Ù…Ø¹Ø©Ù Ù‚Ù†Ø§Ø©Ù Ø§Ù„Ø³ÙˆÙŠØ³: Ù…Ù†Ø§Ø±Ø©Ù Ø§Ù„Ø¹Ù„Ù…Ù",
                text: "Ù…Ù† Ø¨Ø¹Ø¯Ù‡Ø§Ø› Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ù†ØµØ±Ù Ø£ØªÙ‰. ÙÙ†Ø¨ØªØª Ø¨Ø£Ø­Ø´Ø§Ø¦ÙŠ Ù…Ù†Ø§Ø±Ø© Ø§Ù„Ø¹Ù„Ù… Ø§Ù„ØªÙŠØŒ Ø£ÙØ®Ø± Ø¨Ù‡Ø§ØŒ ÙˆÙ…Ø§ ØªØºØ±Ø³Ù‡ Ù…Ù† ÙˆØ¹ÙŠ! Ø£Ù‚Ø¯Ù… Ø¥Ù„ÙŠÙƒÙ…Ø› Ø¬Ø§Ù…Ø¹Ø© Ù‚Ù†Ø§Ø© Ø§Ù„Ø³ÙˆÙŠØ³! Ù…Ù†Ø§Ø±Ø© Ø§Ù„Ø¹Ù„Ù….",
                icon: "ğŸ“ğŸ’¡",
                imageUrl: "https://placehold.co/1920x1080/DAA520/FFFFFF?text=University+Campus",
                ambientSound: 'academic_aura'
            }
        ];

        let currentSceneIndex = 0;
        const storyContainer = document.getElementById('story-container');
        const storyTitle = document.getElementById('story-title');
        const storyText = document.getElementById('story-text');
        const storyIcon = document.getElementById('story-icon');
        const prevSceneBtn = document.getElementById('prev-scene-btn');
        const nextSceneBtn = document.getElementById('next-scene-btn');
        const readTextBtn = document.getElementById('read-text-btn');
        const currentSceneIndicator = document.getElementById('current-scene-indicator');
        const totalScenesIndicator = document.getElementById('total-scenes-indicator');
        const inspireMeBtn = document.getElementById('inspire-me-btn');
        const imagineFirstDayBtn = document.getElementById('imagine-first-day-btn');
        const aiResponseArea = document.getElementById('ai-response-area');
        const aiResponseText = document.getElementById('ai-response-text');
        const loadingSpinner = aiResponseArea.querySelector('.loading-spinner');
        const studentNameInput = document.getElementById('student-name-input');
        const studentCountryInput = document.getElementById('student-country-input');
        const getPersonalizedWelcomeBtn = document.getElementById('get-personalized-welcome-btn');
        const personalizedWelcomeOutput = document.getElementById('personalized-welcome-output');
        const personalizedWelcomeText = personalizedWelcomeOutput.querySelector('p');
        const personalizedWelcomeSpinner = personalizedWelcomeOutput.querySelector('.loading-spinner');

        let currentUtterance = null;
        let femaleVoice = null; 

        // Tone.js setup for background music
        let backgroundSynth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: "sine" },
            envelope: { attack: 3, decay: 1, sustain: 0.7, release: 5 }
        }).toDestination();
        backgroundSynth.volume.value = -18;

        let musicLoop;
        let isMusicPlaying = false;

        function startMusic() {
            if (!musicLoop) {
                const chords = [
                    ["C4", "E4", "G4"],
                    ["F4", "A4", "C5"],
                    ["G4", "B4", "D5"],
                    ["A3", "C4", "E4"]
                ];
                let chordIndex = 0;
                musicLoop = new Tone.Loop(time => {
                    backgroundSynth.triggerAttackRelease(chords[chordIndex % chords.length], "4n", time);
                    chordIndex++;
                }, "2n").start(0);
            }
            Tone.Transport.start();
            isMusicPlaying = true;
            document.getElementById('toggle-music').textContent = 'ğŸ¶';
        }

        function stopMusic() {
            Tone.Transport.stop();
            Tone.Transport.cancel(); 
            backgroundSynth.releaseAll();
            musicLoop = null; 
            isMusicPlaying = false;
            document.getElementById('toggle-music').textContent = 'ğŸ”‡';
        }

        document.getElementById('toggle-music').addEventListener('click', async () => {
            await Tone.start();
            if (isMusicPlaying) {
                stopMusic();
            } else {
                startMusic();
            }
        });

        // Tone.js setup for ambient sound
        let ambientSynth = new Tone.NoiseSynth({
            envelope: {
                attack: 0.05,
                decay: 0.5,
                sustain: 0.5,
                release: 1
            }
        }).toDestination();
        ambientSynth.volume.value = -30;
        let ambientNoiseLoop;
        let isAmbientSoundPlaying = false;

        function startAmbientSound(type) {
            if (ambientNoiseLoop) { 
                ambientNoiseLoop.stop();
                ambientNoiseLoop = null;
            }
            
            if (type === 'desert_wind') {
                ambientSynth.set({ noise: { type: 'white' }, envelope: { attack: 1, decay: 2, sustain: 0.8, release: 3 } });
                ambientNoiseLoop = new Tone.Loop(time => {
                    ambientSynth.triggerAttackRelease("8n", time, Math.random() * 0.4 + 0.6);
                }, "2n").start(0);
            } else if (type === 'oasis_life') {
                ambientSynth.set({ noise: { type: 'pink' }, envelope: { attack: 0.05, decay: 0.2, sustain: 0.3, release: 0.5 } });
                ambientNoiseLoop = new Tone.Loop(time => {
                    ambientSynth.triggerAttackRelease("32n", time, Math.random() * 0.1 + 0.9, Math.random() * 0.5 + 0.5);
                }, "0.5s").start(0);
            } else if (type === 'trade_hub') {
                ambientSynth.set({ noise: { type: 'brown' }, envelope: { attack: 0.1, decay: 0.5, sustain: 0.4, release: 0.8 } });
                ambientNoiseLoop = new Tone.Loop(time => {
                    ambientSynth.triggerAttackRelease("4n", time, Math.random() * 0.1 + 0.9);
                }, "1s").start(0);
            } else if (type === 'urban_transformation') {
                ambientSynth.set({ noise: { type: 'brown' }, envelope: { attack: 0.2, decay: 0.8, sustain: 0.7, release: 1.5 } });
                ambientNoiseLoop = new Tone.Loop(time => {
                    ambientSynth.triggerAttackRelease("2n", time, Math.random() * 0.05 + 0.95);
                }, "2n").start(0);
            } else if (type === 'resilience_spirit') {
                ambientSynth.set({ noise: { type: 'pink' }, envelope: { attack: 2, decay: 1, sustain: 0.9, release: 4 } });
                ambientNoiseLoop = new Tone.Loop(time => {
                    ambientSynth.triggerAttackRelease("1n", time, 0.5);
                }, "4n").start(0);
            } else if (type === 'academic_aura') {
                 ambientSynth.set({ noise: { type: 'white' }, envelope: { attack: 0.1, decay: 0.5, sustain: 0.5, release: 1 } });
                ambientNoiseLoop = new Tone.Loop(time => {
                    ambientSynth.triggerAttackRelease("8n", time, Math.random() * 0.1 + 0.9, Math.random() * 0.3 + 0.7);
                }, "1s").start(0);
            } else if (type === 'none') {
                // Do nothing if type is 'none'
            }

            if (ambientNoiseLoop) { 
                Tone.Transport.start();
                isAmbientSoundPlaying = true;
                document.getElementById('toggle-ambient-sound').textContent = 'ğŸƒ';
            }
        }

        function stopAmbientSound() {
            if (ambientNoiseLoop) {
                ambientNoiseLoop.stop();
                ambientNoiseLoop = null;
            }
            if (!isMusicPlaying) {
                Tone.Transport.stop();
                Tone.Transport.cancel();
            }
            isAmbientSoundPlaying = false;
            document.getElementById('toggle-ambient-sound').textContent = 'ğŸ”‡';
        }

        document.getElementById('toggle-ambient-sound').addEventListener('click', async () => {
            await Tone.start();
            if (isAmbientSoundPlaying) {
                stopAmbientSound();
            } else {
                startAmbientSound(storyScenes[currentSceneIndex].ambientSound || 'desert_wind');
            }
        });

        // Function to select female Arabic voice
        function selectFemaleArabicVoice() {
            const voices = window.speechSynthesis.getVoices();
            let selectedVoice = null;

            const preferredNames = [
                'Arabic (Saudi Arabia) (Female)', 'Amira', 'Tarab', 
                'ar-SA-Standard-A', 'ar-EG-Standard-A' 
            ];

            for (const name of preferredNames) {
                selectedVoice = voices.find(voice => voice.lang.startsWith('ar') && voice.name.includes(name));
                if (selectedVoice) break;
            }

            if (!selectedVoice) {
                selectedVoice = voices.find(voice => voice.gender === 'female' || voice.name.includes('female') || voice.name.includes('Female'));
            }

            if (!selectedVoice) {
                selectedVoice = voices.find(voice => voice.lang.startsWith('ar'));
            }

            return selectedVoice;
        }

        window.speechSynthesis.onvoiceschanged = () => {
            femaleVoice = selectFemaleArabicVoice();
            if (!femaleVoice) {
                console.warn('No suitable Arabic female voice found. Text-to-speech might use a default or male voice.');
            } else {
                console.log('Selected voice for playback:', femaleVoice.name, femaleVoice.lang);
            }
        };


        function updateScene() {
            const scene = storyScenes[currentSceneIndex];
            // Set background image
            storyContainer.style.backgroundImage = `url('${scene.imageUrl}')`;
            // No longer need mood classes for background colors, but keep for consistency in naming if needed for other styles
            storyContainer.classList.remove(...Array.from(storyContainer.classList).filter(c => c.startsWith('mood-')));
            // The mood class is still useful for semantic grouping or potential future styling, even if not directly for background-color anymore.
            storyContainer.classList.add(scene.mood);

            storyTitle.textContent = scene.title;
            storyText.textContent = scene.text;
            
            storyTitle.classList.remove('animate-fadeInText');
            storyText.classList.remove('animate-fadeInText');
            void storyTitle.offsetWidth; 
            void storyText.offsetWidth; 
            storyTitle.classList.add('animate-fadeInText');
            storyText.classList.add('animate-fadeInText');

            storyIcon.textContent = scene.icon;
            storyIcon.classList.remove('animate-pulseIcon');
            void storyIcon.offsetWidth; 
            storyIcon.classList.add('animate-pulseIcon');

            prevSceneBtn.disabled = currentSceneIndex === 0;
            prevSceneBtn.classList.toggle('opacity-50', currentSceneIndex === 0);
            prevSceneBtn.classList.toggle('cursor-not-allowed', currentSceneIndex === 0);

            nextSceneBtn.disabled = currentSceneIndex === storyScenes.length - 1;
            nextSceneBtn.classList.toggle('opacity-50', currentSceneIndex === storyScenes.length - 1);
            nextSceneBtn.classList.toggle('cursor-not-allowed', currentSceneIndex === storyScenes.length - 1);

            currentSceneIndicator.textContent = currentSceneIndex + 1;
            totalScenesIndicator.textContent = storyScenes.length;

            aiResponseArea.classList.add('hidden');
            aiResponseText.textContent = '';
            
            if (imagineFirstDayBtn) {
                imagineFirstDayBtn.classList.add('hidden');
                if (currentSceneIndex === storyScenes.length - 1) {
                    imagineFirstDayBtn.classList.remove('hidden');
                }
            }


            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
            
            stopAmbientSound();
            const newAmbientSoundType = scene.ambientSound || 'none';
            if (newAmbientSoundType !== 'none') {
                 startAmbientSound(newAmbientSoundType);
            }
        }

        prevSceneBtn.addEventListener('click', () => {
            if (currentSceneIndex > 0) {
                currentSceneIndex--;
                updateScene();
            }
        });

        nextSceneBtn.addEventListener('click', () => {
            if (currentSceneIndex < storyScenes.length - 1) {
                currentSceneIndex++;
                updateScene();
            }
        });

        readTextBtn.addEventListener('click', () => {
            if ('speechSynthesis' in window) {
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                } else {
                    const textToSpeak = storyText.textContent;
                    currentUtterance = new SpeechSynthesisUtterance(textToSpeak);
                    currentUtterance.lang = 'ar-SA'; 
                    if (femaleVoice) {
                        currentUtterance.voice = femaleVoice;
                    }
                    window.speechSynthesis.speak(currentUtterance);
                }
            } else {
                alert('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø§ØµÙŠØ© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ.');
            }
        });

        async function callGeminiAPI(prompt, outputElement, spinnerElement) {
            outputElement.classList.remove('hidden');
            outputElement.classList.remove('animate-fadeIn'); 
            outputElement.querySelector('p').textContent = '';
            spinnerElement.classList.remove('hidden');

            const apiKey = "AIzaSyBt3W-fHQ-PPQBTPNlvKrC-XdVt_hz97QI"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    outputElement.querySelector('p').textContent = result.candidates[0].content.parts[0].text;
                    outputElement.classList.add('animate-fadeIn');
                } else {
                    outputElement.querySelector('p').textContent = 'ØªØ¹Ø°Ø± ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                outputElement.querySelector('p').textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ù…ÙˆØ°Ø¬. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
            } finally {
                spinnerElement.classList.add('hidden');
            }
        }

        inspireMeBtn.addEventListener('click', () => {
            const currentStoryText = storyScenes[currentSceneIndex].text;
            const sceneTitle = storyScenes[currentSceneIndex].title;
            const prompt = `Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù…Ù† Ù‚ØµØ© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ¹Ù†ÙˆØ§Ù†Ù‡ "${sceneTitle}": "${currentStoryText}"ØŒ Ø§Ø³ØªØ®Ø±Ø¬ Ø³Ø¤Ø§Ù„Ø§Ù‹ ØªØ£Ù…Ù„ÙŠØ§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹ ÙŠÙ„Ù‡Ù… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ÙˆØ§ÙØ¯ÙŠÙ† Ù„Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ ÙˆØ¯ÙˆØ±Ù‡Ù… ÙƒØ¬Ø²Ø¡ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù‚ØµØ© ÙˆØ§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ Ø§Ù„Ø¹Ø§Ù…. Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ ÙˆÙ…Ø¨Ø§Ø´Ø±Ø©.`;
            callGeminiAPI(prompt, aiResponseArea, loadingSpinner);
        });

        imagineFirstDayBtn.addEventListener('click', () => {
            const prompt = `ØªØ®ÙŠÙ„ ÙˆØ§ÙƒØªØ¨ ÙˆØµÙÙ‹Ø§ Ø­ÙŠÙˆÙŠÙ‹Ø§ ÙˆÙ…Ø±ÙŠØ­Ù‹Ø§ Ù„ÙÙ…Ø§ Ù‚Ø¯ ÙŠØ¨Ø¯Ùˆ Ø¹Ù„ÙŠÙ‡ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§ÙØ¯ Ø¬Ø¯ÙŠØ¯ ÙŠØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ© ÙˆÙŠÙ„ØªØ­Ù‚ Ø¨Ø¬Ø§Ù…Ø¹Ø© Ù‚Ù†Ø§Ø© Ø§Ù„Ø³ÙˆÙŠØ³. Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø¹Ø± Ø§Ù„ØªØ±Ø­Ø§Ø¨ØŒ Ø§Ù„Ø£Ù…Ø§Ù†ØŒ Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø§Ù†Ø¯Ù…Ø§Ø¬ØŒ Ø§Ù„Ø£Ø¬ÙˆØ§Ø¡ Ø§Ù„ÙˆØ¯ÙˆØ¯Ø©ØŒ ÙˆØ¬Ù…Ø§Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ù„ØªØ·Ù…ÙŠÙ†Ù‡ ÙˆØ¨Ø¹Ø« Ø§Ù„Ø­Ù…Ø§Ø³ ÙÙŠÙ‡. Ø§Ø¬Ø¹Ù„ Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ ÙÙŠ ÙÙ‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.`;
            callGeminiAPI(prompt, aiResponseArea, loadingSpinner);
        });

        getPersonalizedWelcomeBtn.addEventListener('click', () => {
            const studentName = studentNameInput.value.trim();
            const studentCountry = studentCountryInput.value.trim();
            let prompt = `Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© Ù‚ØµÙŠØ±Ø© ÙˆØ¯Ø§ÙØ¦Ø© Ù…Ù† "Ø±ÙˆØ­ Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©" Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§ÙØ¯ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø¬Ø§Ù…Ø¹Ø© Ù‚Ù†Ø§Ø© Ø§Ù„Ø³ÙˆÙŠØ³. Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø¹Ø± Ø§Ù„ØªØ±Ø­Ø§Ø¨ØŒ Ø§Ù„Ø£Ù…Ø§Ù†ØŒ Ø§Ù„Ø§Ù†ØªÙ…Ø§Ø¡ØŒ ÙˆØ¬Ù…Ø§Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙƒÙ€"ÙˆØ§Ø­Ø© Ø¹Ù„Ù…" ØªØ­ØªØ¶Ù†Ù‡.`;
            if (studentName && studentCountry) {
                prompt += ` Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ø³Ù…Ù‡ ${studentName} ÙˆÙ…Ù† Ø¯ÙˆÙ„Ø© ${studentCountry}.`;
            } else if (studentName) {
                prompt += ` Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ø³Ù…Ù‡ ${studentName}.`;
            } else if (studentCountry) {
                prompt += ` Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ø¯ÙˆÙ„Ø© ${studentCountry}.`;
            }
            prompt += ` Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ ÙˆØ¨Ø£Ø³Ù„ÙˆØ¨ Ø£Ù…ÙˆÙ…ÙŠ Ø­Ù†ÙˆÙ† (ÙƒØµÙˆØª Ø§Ù„Ø£Ø±Ø¶).`;

            callGeminiAPI(prompt, personalizedWelcomeOutput, personalizedWelcomeSpinner);
        });

        // Initial setup
        window.onload = function() {
            totalScenesIndicator.textContent = storyScenes.length;
            updateScene();
            startMusic(); 
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
            femaleVoice = selectFemaleArabicVoice();
            if (!femaleVoice) {
                console.warn('No suitable Arabic female voice found after load. Text-to-speech might use a default or male voice.');
            } else {
                console.log('Selected voice on load:', femaleVoice.name, femaleVoice.lang);
            }
        };
    </script>
</body>
</html>
